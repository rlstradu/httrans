<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CharPanda</title>
<style>
  /* Base styles */
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f4f7fa;
    margin: 0;
    padding: 40px;
    box-sizing: border-box;
    color: #333;
    transition: background 0.3s ease, color 0.3s ease;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  header {
    max-width: 900px;
    margin: 0 auto 40px auto;
    text-align: center;
  }
  header p {
    font-size: 1.2rem;
    color: #444;
    line-height: 1.6;
    max-width: 700px;
    margin: 0 auto;
    user-select: none;
  }
  main {
    flex-grow: 1;
    display: flex;
    gap: 30px;
    max-width: 900px;
    margin: 0 auto;
    justify-content: center;
    align-items: flex-start;
  }
  .container {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: #fff;
    padding: 20px 25px 25px 25px;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgb(0 0 0 / 0.1);
    transition: background 0.3s ease, box-shadow 0.3s ease;
  }
  h2 {
    margin: 0 0 15px 0;
    font-weight: 700;
    font-size: 1.5rem;
    color: #2c3e50;
    user-select: none;
    transition: color 0.3s ease;
  }
  /* MODIFICADO: Estilos para las opciones de límite */
  .limit-options {
    display: flex;
    gap: 15px 25px; /* Espacio vertical y horizontal */
    margin-top: 20px; /* Espacio sobre las opciones */
    align-items: left;
    flex-wrap: wrap;
    font-size: 0.9rem;
    color: #444;
    padding: 10px;
    background: #f0f3f7;
    border-radius: 8px;
    box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
  }
  .limit-options div {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .limit-options input[type="number"] {
    width: 60px;
    padding: 3px 6px;
    font-size: 0.9rem;
    border-radius: 5px;
    border: 1px solid #d0d7de;
    text-align: center;
  }
  textarea {
    resize: both; 
    min-height: 150px; 
    border: 2px solid #d0d7de;
    border-radius: 10px;
    padding: 15px 18px;
    font-size: 1.1rem;
    line-height: 1.5;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    transition: border-color 0.3s ease, background 0.3s ease, color 0.3s ease;
    outline-offset: 2px;
    color: #2c3e50;
    background: #fafafa;
    overflow: auto; 
  }
  textarea:focus {
    border-color: #3b82f6;
    background: #fff;
  }
  .counter-area {
    margin-top: 15px;
    text-align: right;
    display: flex;
    flex-wrap: wrap;
    gap: 10px 25px; 
    justify-content: flex-end;
    align-items: center; 
    font-weight: 700;
    font-size: 1rem;
    color: #3b82f6;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    user-select: none;
    transition: color 0.3s ease;
  }
  .counter-area .counter-item {
    font-size: 1.2rem;
    white-space: nowrap;
  }
  .counter-area .limit-group { 
    display: flex;
    align-items: center;
    gap: 8px; 
  }
  .counter-area input[type="number"] {
    width: 80px;
    padding: 5px 8px;
    border-radius: 5px;
    border: 1px solid #d0d7de;
    text-align: center;
    font-size: 0.9rem;
    color: #2c3e50;
    background: #fafafa;
    transition: border-color 0.3s ease, background 0.3s ease, color 0.3s ease;
  }
  .counter-area input[type="number"]:focus {
    border-color: #3b82f6;
    background: #fff;
  }
  .counter-area .limit-exceeded {
    color: #f44336; 
  }

  .button-container {
    margin-top: 20px; 
    padding: 10px 15px; 
    background: #f0f3f7; 
    border-radius: 8px; 
    display: flex;
    flex-wrap: nowrap; 
    gap: 8px; 
    justify-content: center; 
    box-shadow: inset 0 2px 5px rgba(0,0,0,0.05); 
    transition: background 0.3s ease, box-shadow 0.3s ease;
    overflow-x: auto; 
  }
  button.action-btn {
    background: #3b82f6;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 8px 15px; 
    font-size: 1rem; 
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.15s ease;
    user-select: none;
    white-space: nowrap; 
  }
  button.action-btn svg {
    width: 20px; 
    height: 20px; 
    fill: currentColor; 
  }
  .settings-buttons button {
    background: #3b82f6;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 10px 20px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.15s ease;
    user-select: none;
  }
  button.action-btn:hover, .settings-buttons button:hover {
    background: #2563eb;
    transform: scale(1.05);
  }
  button.action-btn:active, .settings-buttons button:active {
    transform: scale(0.95);
  }
  button.action-btn.copied {
    background: #10b981;
  }
  button.action-btn.pasted {
    background: #059669;
  }
  button.action-btn.cleared {
    background: #ff9800; 
  }
  .settings-buttons {
    margin-top: 20px;
    display: flex;
    justify-content: center;
    gap: 15px;
  }
  .app-logo {
    max-width: 300px; 
    height: auto;
    margin-bottom: 10px;
  }

  /* Footer styles */
  footer {
    margin-top: 40px;
    text-align: center;
    font-size: 0.85rem;
    color: #666;
    padding: 20px 0;
    border-top: 1px solid #e0e0e0;
    transition: color 0.3s ease, border-color 0.3s ease;
  }
  footer .httrans-link {
    display: inline-flex; 
    align-items: center; 
    text-decoration: none; 
    color: inherit; 
  }
  footer .httrans-logo {
    height: 40px; 
    vertical-align: middle;
    margin-left: 8px; 
    transition: filter 0.3s ease; 
  }
  footer .httrans-logo:hover {
    filter: drop-shadow(0 0 10px rgba(255, 0, 0, 0.7)); 
  }

  /* Dark mode styles */
  body.dark-mode {
    background: #282c34; 
    color: #f0f0f0; 
  }
  body.dark-mode .limit-options {
    color: #bbb;
    background: #30343a;
    box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
  }
  body.dark-mode header p {
    color: #bbb; 
  }
  body.dark-mode .container {
    background: #3a3f47; 
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4); 
  }
  body.dark-mode h2 {
    color: #e0e0e0; 
  }
  body.dark-mode textarea {
    background: #4a4f57; 
    border-color: #5a5f67;
    color: #f0f0f0; 
  }
  body.dark-mode textarea:focus {
    border-color: #6a9dfa; 
    background: #5a5f67;
  }
  body.dark-mode .counter-area {
    color: #8ab4f8; 
  }
  body.dark-mode .counter-area input[type="number"], 
  body.dark-mode .limit-options input[type="number"] {
    background: #4a4f57; 
    border-color: #5a5f67;
    color: #f0f0f0; 
  }
  body.dark-mode .counter-area input[type="number"]:focus,
  body.dark-mode .limit-options input[type="number"]:focus {
    border-color: #6a9dfa; 
    background: #5a5f67;
  }
  body.dark-mode .counter-area .limit-exceeded {
    color: #ff7961; 
  }
  body.dark-mode .button-container { 
    background: #30343a; 
    box-shadow: inset 0 2px 5px rgba(0,0,0,0.2); 
  }
  body.dark-mode button.action-btn, body.dark-mode .settings-buttons button {
    background: #6a9dfa; 
  }
  body.dark-mode button.action-btn:hover, body.dark-mode .settings-buttons button:hover {
    background: #4d8df6; 
  }
  body.dark-mode button.action-btn.copied {
    background: #4CAF50; 
  }
  body.dark-mode button.action-btn.pasted {
    background: #388E3C; 
  }
  body.dark-mode button.action-btn.cleared {
    background: #FFB300; 
  }
  
  body.dark-mode .app-logo {
    filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.5)); 
  }
  body.dark-mode footer {
    color: #999;
    border-color: #444;
  }
  body.dark-mode footer .httrans-logo {
    filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.7)); 
  }
  body.dark-mode footer .httrans-logo:hover {
    filter: drop-shadow(0 0 10px rgba(255, 0, 0, 0.9)); 
  }

  /* Responsive design */
  @media (max-width: 768px) {
    body {
      padding: 20px;
    }
    main {
      flex-direction: column;
      height: auto; 
    }
    .container {
      margin-bottom: 20px;
    }
    header {
      margin-bottom: 20px;
    }
    .settings-buttons {
      flex-direction: column;
      gap: 10px;
      padding: 0 20px;
    }
    .button-container {
      flex-direction: row; 
      justify-content: center; 
      gap: 8px; 
    }
    .counter-area {
      justify-content: flex-start; 
    }
  }
</style>
</head>
<body>

<header>
  <img src="https://raw.githubusercontent.com/rlstradu/httrans/refs/heads/main/charpanda-logo.png" alt="CharPanda Logo" class="app-logo">
  <p id="app-description"></p>
  <div class="settings-buttons">
    <button id="modeToggle"></button>
    <button id="languageToggle"></button>
  </div>
</header>

<main>
  <div class="container">
    <h2 id="text1-title"></h2>
    <textarea id="pasteArea"></textarea>
    <div class="counter-area">
      <span class="counter-item" id="pasteCharCount"></span>
      <span class="counter-item" id="pasteWordCount"></span>
      <div class="counter-item limit-group">
        <label for="pasteLimitInput" id="pasteLimitLabel"></label>
        <input type="number" id="pasteLimitInput" min="0" placeholder="0">
      </div>
      <span class="counter-item" id="pasteRemainingCount"></span>
    </div>
    <div class="button-container">
      <button class="action-btn" id="copyPaste"></button>
      <button class="action-btn" id="pasteBtn"></button>
      <button class="action-btn" id="clearPaste"></button>
      <button class="action-btn" id="upperPaste"></button>
      <button class="action-btn" id="lowerPaste"></button>
    </div>
  </div>

  <div class="container">
    <h2 id="text2-title"></h2>
    <textarea id="writeArea"></textarea>
    <div class="counter-area">
      <span class="counter-item" id="writeCharCount"></span>
      <span class="counter-item" id="writeWordCount"></span>
      <div class="counter-item limit-group">
        <label for="writeLimitInput" id="writeLimitLabel"></label>
        <input type="number" id="writeLimitInput" min="0" placeholder="0">
      </div>
      <span class="counter-item" id="writeRemainingCount"></span>
    </div>
    <div class="button-container">
      <button class="action-btn" id="copyWrite"></button>
      <button class="action-btn" id="pasteWrite"></button>
      <button class="action-btn" id="clearWrite"></button>
      <button class="action-btn" id="upperWrite"></button>
      <button class="action-btn" id="lowerWrite"></button>
    </div>
    <!-- INICIO DE CONTROLES REUBICADOS -->
    <div class="limit-options">
      <div>
        <input type="checkbox" id="matchSourceLimit">
        <label for="matchSourceLimit" id="matchSourceLimitLabel"></label>
      </div>
      <div>
        <input type="checkbox" id="percentageLimit">
        <label for="percentageLimit" id="percentageLimitLabel"></label>
        <input type="number" id="percentageInput" value="30" min="0">
        <span>%</span>
      </div>
    </div>
    <!-- FIN DE CONTROLES REUBICADOS -->
  </div>
</main>

<footer>
  <a href="https://rlstradu.github.io/httrans/" target="_blank" class="httrans-link">
    <span id="footer-text"></span>
    <img src="https://raw.githubusercontent.com/rlstradu/httrans/refs/heads/main/httrans-logo-final.png" alt="httrans logo" class="httrans-logo">
  </a>
</footer>

<script>
  // Get DOM elements
  const pasteArea = document.getElementById('pasteArea');
  const writeArea = document.getElementById('writeArea');

  const pasteCharCount = document.getElementById('pasteCharCount');
  const pasteWordCount = document.getElementById('pasteWordCount');
  const pasteLimitInput = document.getElementById('pasteLimitInput');
  const pasteLimitLabel = document.getElementById('pasteLimitLabel');
  const pasteRemainingCount = document.getElementById('pasteRemainingCount');

  const writeCharCount = document.getElementById('writeCharCount');
  const writeWordCount = document.getElementById('writeWordCount');
  const writeLimitInput = document.getElementById('writeLimitInput');
  const writeLimitLabel = document.getElementById('writeLimitLabel');
  const writeRemainingCount = document.getElementById('writeRemainingCount');

  const copyPasteBtn = document.getElementById('copyPaste');
  const copyWriteBtn = document.getElementById('copyWrite');
  const pasteBtn = document.getElementById('pasteBtn');
  const pasteWriteBtn = document.getElementById('pasteWrite');
  const clearPasteBtn = document.getElementById('clearPaste');
  const clearWriteBtn = document.getElementById('clearWrite');
  const upperPasteBtn = document.getElementById('upperPaste');
  const lowerPasteBtn = document.getElementById('lowerPaste');
  const upperWriteBtn = document.getElementById('upperWrite');
  const lowerWriteBtn = document.getElementById('lowerWrite');

  const modeToggleBtn = document.getElementById('modeToggle');
  const languageToggleBtn = document.getElementById('languageToggle');
  const footerTextSpan = document.getElementById('footer-text');

  // Get new DOM elements for limit options
  const matchSourceLimitCheckbox = document.getElementById('matchSourceLimit');
  const matchSourceLimitLabel = document.getElementById('matchSourceLimitLabel');
  const percentageLimitCheckbox = document.getElementById('percentageLimit');
  const percentageLimitLabel = document.getElementById('percentageLimitLabel');
  const percentageInput = document.getElementById('percentageInput');

  // Elements to translate
  const appDescription = document.getElementById('app-description');
  const text1Title = document.getElementById('text1-title');
  const text2Title = document.getElementById('text2-title');

  // Translation object
  const translations = {
    es: {
      appDescription: 'CharPanda es una aplicación sencilla para contar caracteres. Tienes dos campos por si necesitas comparar dos textos. Que la disfrutes.',
      modeToggleDark: 'Modo oscuro',
      modeToggleLight: 'Modo claro',
      languageToggle: 'English',
      text1Title: 'Texto 1 (Original)',
      text2Title: 'Texto 2 (Traducido)',
      pastePlaceholder: 'Pega tu texto aquí...',
      writePlaceholder: 'Escribe tu texto aquí...',
      characters: 'Caracteres',
      words: 'Palabras',
      limit: 'Límite',
      remaining: 'Restantes',
      pasteButton: 'Pegar',
      copyButton: 'Copiar',
      clearButton: 'Borrar',
      uppercaseButton: 'MAYÚSCULAS',
      lowercaseButton: 'minúsculas',
      copied: '¡Copiado!',
      pasted: '¡Pegado!',
      cleared: '¡Borrado!',
      copyError: 'Error al copiar. Intenta de nuevo.',
      pasteError: 'No se pudo pegar el texto. Por favor, permite el acceso al portapapeles.',
      limitExceeded: 'Límite de caracteres excedido',
      footerText: 'Esta aplicación ha sido desarrollada por Rafael López Sánchez y forma parte del proyecto httrans.',
      matchSourceLimitLabel: 'El texto de origen no puede superar el límite del texto traducido',
      percentageLimitLabel: 'El texto traducido no puede exceder el original en más de un'
    },
    en: {
      appDescription: 'CharPanda is a simple character counting application. There are two fields in case you need to compare texts. Enjoy!',
      modeToggleDark: 'Dark mode',
      modeToggleLight: 'Light mode',
      languageToggle: 'Español',
      text1Title: 'Text 1 (Source)',
      text2Title: 'Text 2 (Target)',
      pastePlaceholder: 'Paste your text here...',
      writePlaceholder: 'Write your text here...',
      characters: 'Characters',
      words: 'Words',
      limit: 'Limit',
      remaining: 'Remaining',
      pasteButton: 'Paste',
      copyButton: 'Copy',
      clearButton: 'Clear',
      uppercaseButton: 'UPPERCASE',
      lowercaseButton: 'lowercase',
      copied: 'Copied!',
      pasted: 'Pasted!',
      cleared: 'Cleared!',
      copyError: 'Error copying. Please try again.',
      pasteError: 'Could not paste text. Please allow clipboard access.',
      limitExceeded: 'Character limit exceeded',
      footerText: 'This application has been developed by Rafael López Sánchez and is part of the httrans project.',
      matchSourceLimitLabel: 'Target cannot exceed source limit',
      percentageLimitLabel: 'Target cannot exceed source by more than'
    }
  };

  let currentLanguage = localStorage.getItem('language') || 'en';

  // Function to update character and word count, and remaining characters
  function updateCounts(textarea, charCounter, wordCounter, limitInput, remainingCounter) {
    const text = textarea.value;
    const charLength = text.length;
    const words = text.split(/\s+/).filter(word => word.length > 0).length;
    const limit = parseInt(limitInput.value, 10);

    charCounter.textContent = `${translations[currentLanguage].characters}: ${charLength}`;
    wordCounter.textContent = `${translations[currentLanguage].words}: ${words}`;

    if (!isNaN(limit) && limit > 0) {
      const remaining = limit - charLength;
      remainingCounter.textContent = `${translations[currentLanguage].remaining}: ${remaining}`;
      if (remaining < 0) {
        remainingCounter.classList.add('limit-exceeded');
        charCounter.classList.add('limit-exceeded');
      } else {
        remainingCounter.classList.remove('limit-exceeded');
        charCounter.classList.remove('limit-exceeded');
      }
    } else {
      remainingCounter.textContent = '';
      charCounter.classList.remove('limit-exceeded');
    }
  }

  // Updates the limit of the write area based on the options
  function updateWriteAreaLimit() {
    const sourceLength = pasteArea.value.length;

    if (matchSourceLimitCheckbox.checked) {
      writeLimitInput.value = sourceLength;
      writeLimitInput.disabled = true;
    } else if (percentageLimitCheckbox.checked) {
      const percentage = parseFloat(percentageInput.value) || 0;
      const newLimit = Math.ceil(sourceLength * (1 + percentage / 100));
      writeLimitInput.value = newLimit;
      writeLimitInput.disabled = true;
    } else {
      writeLimitInput.disabled = false;
    }
    // Call updateCounts for the write area to reflect the new limit
    updateCounts(writeArea, writeCharCount, writeWordCount, writeLimitInput, writeRemainingCount);
  }

  // Function to set the language
  function setLanguage(lang) {
    currentLanguage = lang;
    localStorage.setItem('language', lang);

    appDescription.textContent = translations[lang].appDescription;
    languageToggleBtn.textContent = translations[lang].languageToggle;
    text1Title.textContent = translations[lang].text1Title;
    text2Title.textContent = translations[lang].text2Title;
    pasteArea.placeholder = translations[lang].pastePlaceholder;
    writeArea.placeholder = translations[lang].writePlaceholder;
    pasteLimitLabel.textContent = translations[lang].limit + ':';
    writeLimitLabel.textContent = translations[lang].limit + ':';
    footerTextSpan.textContent = translations[lang].footerText;
    
    matchSourceLimitLabel.textContent = translations[lang].matchSourceLimitLabel;
    percentageLimitLabel.textContent = translations[lang].percentageLimitLabel;

    pasteBtn.textContent = translations[lang].pasteButton;
    copyPasteBtn.textContent = translations[lang].copyButton;
    clearPasteBtn.textContent = translations[lang].clearButton;
    upperPasteBtn.textContent = translations[lang].uppercaseButton;
    lowerPasteBtn.textContent = translations[lang].lowercaseButton;
    
    pasteWriteBtn.textContent = translations[lang].pasteButton;
    copyWriteBtn.textContent = translations[lang].copyButton;
    clearWriteBtn.textContent = translations[lang].clearButton;
    upperWriteBtn.textContent = translations[lang].uppercaseButton;
    lowerWriteBtn.textContent = translations[lang].lowercaseButton;

    const isDarkMode = document.body.classList.contains('dark-mode');
    modeToggleBtn.textContent = isDarkMode ? translations[currentLanguage].modeToggleLight : translations[currentLanguage].modeToggleDark;

    updateAllCounts();
  }

  function updateAllCounts() {
    updateCounts(pasteArea, pasteCharCount, pasteWordCount, pasteLimitInput, pasteRemainingCount);
    updateWriteAreaLimit();
  }
  
  // Function to handle copy text
  function copyText(textarea, button) {
    if (textarea.value.length === 0) return;
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(textarea.value).then(() => {
        button.textContent = translations[currentLanguage].copied;
        button.classList.add('copied');
        setTimeout(() => { 
          button.classList.remove('copied');
          button.textContent = translations[currentLanguage].copyButton;
        }, 1800);
      }).catch(err => {
        showMessage(translations[currentLanguage].copyError, 'error');
      });
    } else {
      textarea.select();
      document.execCommand('copy');
      button.textContent = translations[currentLanguage].copied;
      button.classList.add('copied');
      setTimeout(() => {
        button.classList.remove('copied');
        button.textContent = translations[currentLanguage].copyButton;
      }, 1800);
    }
  }

  // Function to handle paste text
  async function pasteText(textarea, button) {
    try {
      const text = await navigator.clipboard.readText();
      if (text.length === 0) return;
      textarea.value = text;
      updateAllCounts();
      button.textContent = translations[currentLanguage].pasted;
      button.classList.add('pasted');
      setTimeout(() => {
        button.classList.remove('pasted');
        button.textContent = translations[currentLanguage].pasteButton;
      }, 1800);
    } catch (err) {
      showMessage(translations[currentLanguage].pasteError, 'error');
    }
  }

  // Function to clear text
  function clearText(textarea, button) {
    textarea.value = '';
    updateAllCounts();
    button.textContent = translations[currentLanguage].cleared;
    button.classList.add('cleared');
    setTimeout(() => {
      button.classList.remove('cleared');
      button.textContent = translations[currentLanguage].clearButton;
    }, 1800);
  }

  // Function to transform text (uppercase/lowercase)
  function transformText(textarea, type) {
    if (textarea.value.length === 0) return;
    if (type === 'upper') {
      textarea.value = textarea.value.toUpperCase();
    } else if (type === 'lower') {
      textarea.value = textarea.value.toLowerCase();
    }
    updateAllCounts();
  }
  
  pasteArea.addEventListener('input', () => {
    updateCounts(pasteArea, pasteCharCount, pasteWordCount, pasteLimitInput, pasteRemainingCount);
    updateWriteAreaLimit();
  });
  
  writeArea.addEventListener('input', () => updateCounts(writeArea, writeCharCount, writeWordCount, writeLimitInput, writeRemainingCount));
  pasteLimitInput.addEventListener('input', () => updateCounts(pasteArea, pasteCharCount, pasteWordCount, pasteLimitInput, pasteRemainingCount));
  writeLimitInput.addEventListener('input', () => updateCounts(writeArea, writeCharCount, writeWordCount, writeLimitInput, writeRemainingCount));

  // Event listeners for the limit options
  matchSourceLimitCheckbox.addEventListener('change', () => {
    if (matchSourceLimitCheckbox.checked) {
      percentageLimitCheckbox.checked = false;
    }
    updateWriteAreaLimit();
  });

  percentageLimitCheckbox.addEventListener('change', () => {
    if (percentageLimitCheckbox.checked) {
      matchSourceLimitCheckbox.checked = false;
    }
    updateWriteAreaLimit();
  });

  percentageInput.addEventListener('input', () => {
    if (!percentageLimitCheckbox.checked) {
      percentageLimitCheckbox.checked = true;
      matchSourceLimitCheckbox.checked = false;
    }
    updateWriteAreaLimit();
  });


  // Initial count update
  updateAllCounts();

  // Event Listeners for action buttons
  copyPasteBtn.addEventListener('click', () => copyText(pasteArea, copyPasteBtn));
  copyWriteBtn.addEventListener('click', () => copyText(writeArea, copyWriteBtn));
  pasteBtn.addEventListener('click', () => pasteText(pasteArea, pasteBtn));
  pasteWriteBtn.addEventListener('click', () => pasteText(writeArea, pasteWriteBtn));
  clearPasteBtn.addEventListener('click', () => clearText(pasteArea, clearPasteBtn));
  clearWriteBtn.addEventListener('click', () => clearText(writeArea, clearWriteBtn));
  upperPasteBtn.addEventListener('click', () => transformText(pasteArea, 'upper'));
  lowerPasteBtn.addEventListener('click', () => transformText(pasteArea, 'lower'));
  upperWriteBtn.addEventListener('click', () => transformText(writeArea, 'upper'));
  lowerWriteBtn.addEventListener('click', () => transformText(writeArea, 'lower'));

  // Mode Toggle functionality
  function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    const isDarkMode = document.body.classList.contains('dark-mode');
    modeToggleBtn.textContent = isDarkMode ? translations[currentLanguage].modeToggleLight : translations[currentLanguage].modeToggleDark;
    localStorage.setItem('darkMode', isDarkMode);
  }

  // Language Toggle functionality
  languageToggleBtn.addEventListener('click', () => {
    setLanguage(currentLanguage === 'es' ? 'en' : 'es');
  });

  modeToggleBtn.addEventListener('click', toggleDarkMode);

  // Load saved preferences on page load
  document.addEventListener('DOMContentLoaded', () => {
    setLanguage(localStorage.getItem('language') || 'en'); 
    const savedDarkMode = localStorage.getItem('darkMode');
    if (savedDarkMode === 'true') {
      document.body.classList.add('dark-mode');
    }
    const isDarkMode = document.body.classList.contains('dark-mode');
    modeToggleBtn.textContent = isDarkMode ? translations[currentLanguage].modeToggleLight : translations[currentLanguage].modeToggleDark;
  });

  // Custom message box function (replaces alert)
  function showMessage(message, type = 'info') {
    const messageBox = document.createElement('div');
    messageBox.style.cssText = `
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: ${type === 'error' ? '#f44336' : '#4CAF50'};
      color: white;
      padding: 15px 25px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    `;
    messageBox.textContent = message;
    document.body.appendChild(messageBox);

    setTimeout(() => { messageBox.style.opacity = '1'; }, 100);

    setTimeout(() => {
      messageBox.style.opacity = '0';
      messageBox.addEventListener('transitionend', () => messageBox.remove());
    }, 3000);
  }

</script>

</body>
</html>
